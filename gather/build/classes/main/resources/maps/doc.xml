<?xml version="1.0" encoding="gbk" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="doc">

	<typeAlias alias="doc" type="com.netease.gather.domain.Doc" />

	<sql id="_columns">
		docno, title, url, source, ptime, channel, createtime
	</sql>

    <insert id="insertOne" parameterClass="doc">
        insert into doc
        (docno,title, url, source, ptime, channel, createtime)
        values(#docno#,#title#, #url#, #source#, #ptime#, #channel#, #createtime#)
        <selectKey resultClass="long" type="post" keyProperty="autoid">
            select last_insert_id() as value
        </selectKey>
    </insert>

    <update id="updateOne" parameterClass="Map">
        update doc
        <dynamic prepend="set">
            <isNotEmpty prepend="and" property="title">
                title=#title#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="url">
                url=#url#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="source">
                source=#source#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="ptime">
                ptime=#ptime#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="channel">
                channel=#channel#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="createtime">
                createtime=#createtime#
            </isNotEmpty>
        </dynamic>
        where docno = #docno#
    </update>

    <sql id="_where">
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="condition">
                <![CDATA[ $condition$ ]]>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="docno">
                docno=#docno#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="title">
                title=#title#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="source">
                source=#source#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="channel">
                channel=#channel#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="starttime">
                <![CDATA[ ptime>=#starttime#]]>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="endtime">
                <![CDATA[ ptime<#endtime#]]>
            </isNotEmpty>
        </dynamic>
    </sql>

    <select id="getListByParameters" parameterClass="Map" resultClass="doc">
        select autoid,
        <include refid="_columns"/>
        from doc
        <include refid="_where"/>
        <isNotEmpty property="order">
            <![CDATA[ order by $order$ ]]>
        </isNotEmpty>
        <dynamic prepend="limit">
            <isNotEmpty property="start">#start#</isNotEmpty>
            <isNotEmpty property="size">, #size#</isNotEmpty>
        </dynamic>
    </select>

    <select id="getCountByParameters" parameterClass="Map" resultClass="java.lang.Integer">
        select count(autoid)
        from doc
        <include refid="_where"/>
        <isNotEmpty property="order">
            <![CDATA[ order by $order$ ]]>
        </isNotEmpty>
        <dynamic prepend="limit">
            <isNotEmpty property="start">#start#</isNotEmpty>
            <isNotEmpty property="size">, #size#</isNotEmpty>
        </dynamic>
    </select>

    <select id="getOneByParameters" parameterClass="Map" resultClass="doc">
        select autoid,
        <include refid="_columns"/>
        from doc
        <include refid="_where"/>
    </select>

    <delete id="deleteSomeByParameters" parameterClass="Map">
        delete
        from doc
        <include refid="_where"/>
    </delete>
</sqlMap>
